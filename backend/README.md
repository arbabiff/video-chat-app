# Video Chat Backend API

ÛŒÚ© Ù¾Ù„ØªÙØ±Ù… ÙˆÛŒØ¯ÛŒÙˆ Ú†Øª ØªØµØ§Ø¯ÙÛŒ Ø¨Ø§ Ø±Ø§Ø¨Ø· ÙØ§Ø±Ø³ÛŒ Ùˆ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡.

## ğŸš€ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

### Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
- Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
- ØªØ£ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
- Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
- Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
- Ø³ÛŒØ³ØªÙ… Ø¯ÙˆØ³ØªØ§Ù† Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÙˆØ³ØªÛŒ
- Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±Ø§Ù†

### Ú†Øª Ùˆ ÙˆÛŒØ¯ÛŒÙˆ Ú©Ø§Ù„
- Ú†Øª ØªØµØ§Ø¯ÙÛŒ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
- ÙˆÛŒØ¯ÛŒÙˆ Ú©Ø§Ù„ Ø¨Ø§ WebRTC
- Socket.IO Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª real-time
- Ø³ÛŒØ³ØªÙ… matching Ù‡ÙˆØ´Ù…Ù†Ø¯
- Ú¯Ø²Ø§Ø±Ø´ Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†

### Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒØ³ØªÙ…
- Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„
- Ø¢Ù…Ø§Ø± Ùˆ Ú¯Ø²Ø§Ø±Ø´Ø§Øª
- Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
- Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ø³Ù„Ø§Ù…Øª Ø³ÛŒØ³ØªÙ…

### Ø§Ù…Ù†ÛŒØª
- Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª JWT
- Ù…Ø­Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
- Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
- Ø­ÙØ§Ø¸Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø­Ù…Ù„Ø§Øª

## ğŸ“‹ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

- Node.js (Ù†Ø³Ø®Ù‡ 16 ÛŒØ§ Ø¨Ø§Ù„Ø§ØªØ±)
- MongoDB (Ù†Ø³Ø®Ù‡ 4.4 ÛŒØ§ Ø¨Ø§Ù„Ø§ØªØ±)
- npm ÛŒØ§ yarn

### Ø§Ø®ØªÛŒØ§Ø±ÛŒ
- Redis (Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯)
- Cloudinary (Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµØ§ÙˆÛŒØ±)
- Stripe (Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª)

## ğŸ›  Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### 1. Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡
```bash
git clone <repository-url>
cd video-chat/backend
```

### 2. Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
```bash
npm install
```

### 3. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø­ÛŒØ·
ÙØ§ÛŒÙ„ `.env.example` Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù‡ Ùˆ Ù†Ø§Ù… Ø¢Ù† Ø±Ø§ Ø¨Ù‡ `.env` ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯:
```bash
cp .env.example .env
```

Ø³Ù¾Ø³ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­ÛŒØ· Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.

### 4. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
MongoDB Ø±Ø§ Ù†ØµØ¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯. Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.

### 5. Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡

#### Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡
```bash
npm run dev
```

#### Ø­Ø§Ù„Øª ØªÙˆÙ„ÛŒØ¯
```bash
npm start
```

## ğŸ“š API Documentation

### Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª (Authentication)

#### Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "displayName": "Test User",
  "gender": "male",
  "birthDate": "1995-01-01",
  "country": "IR"
}
```

#### ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
```http
POST /api/auth/login
Content-Type: application/json

{
  "login": "testuser",
  "password": "password123"
}
```

#### Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
```http
GET /api/auth/me
Authorization: Bearer <token>
```

### Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Users)

#### Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
```http
GET /api/users/search?query=test&gender=female&page=1&limit=20
Authorization: Bearer <token>
```

#### ÛŒØ§ÙØªÙ† Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…Ø·Ø§Ø¨Ù‚
```http
GET /api/users/find-match
Authorization: Bearer <token>
```

#### Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÙˆØ³ØªÛŒ
```http
POST /api/users/{userId}/friend-request
Authorization: Bearer <token>
```

### Ú†Øª (Chat)

#### Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± Ú†Øª
```http
GET /api/chat/stats
Authorization: Bearer <token>
```

#### Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±Ø¨Ø±
```http
POST /api/chat/report
Authorization: Bearer <token>
Content-Type: application/json

{
  "reportedUserId": "user_id",
  "reason": "inappropriate_content",
  "description": "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ"
}
```

#### Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ù‡ Ú†Øª
```http
POST /api/chat/rate
Authorization: Bearer <token>
Content-Type: application/json

{
  "partnerUserId": "user_id",
  "rating": 5
}
```

### Ù…Ø¯ÛŒØ±ÛŒØª (Admin)

#### Ø¢Ù…Ø§Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
```http
GET /api/admin/dashboard
Authorization: Bearer <admin_token>
```

#### Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
```http
GET /api/admin/users?page=1&limit=20&status=active
Authorization: Bearer <admin_token>
```

#### Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±
```http
PUT /api/admin/users/{userId}/status
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "status": "banned"
}
```

## ğŸ”Œ Socket.IO Events

### Ø§ØªØµØ§Ù„ Ùˆ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
```javascript
// Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
const socket = io('http://localhost:8000');

// Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
socket.emit('authenticate', token);

// ØªØ£ÛŒÛŒØ¯ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
socket.on('authenticated', (data) => {
  console.log('Authenticated successfully');
});
```

### Ú†Øª ØªØµØ§Ø¯ÙÛŒ
```javascript
// Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´Ø±ÛŒÚ© Ú†Øª
socket.emit('find_random_chat', {
  genderPreference: 'both',
  ageRange: { min: 18, max: 30 }
});

// ÛŒØ§ÙØªÙ† Ø´Ø±ÛŒÚ©
socket.on('chat_matched', (data) => {
  console.log('Match found:', data.partner);
});

// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
socket.emit('send_message', {
  roomId: 'room_id',
  message: 'Ø³Ù„Ø§Ù…!',
  type: 'text'
});

// Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…
socket.on('new_message', (messageData) => {
  console.log('New message:', messageData);
});
```

### ÙˆÛŒØ¯ÛŒÙˆ Ú©Ø§Ù„
```javascript
// Ø´Ø±ÙˆØ¹ ØªÙ…Ø§Ø³
socket.emit('initiate_call', {
  targetUserId: 'user_id',
  callType: 'video'
});

// Ù¾Ø°ÛŒØ±Ø´ ØªÙ…Ø§Ø³
socket.emit('accept_call', {
  callId: 'call_id'
});

// WebRTC Signaling
socket.emit('webrtc_offer', {
  callId: 'call_id',
  offer: rtcOffer
});

socket.on('webrtc_answer', (data) => {
  // Handle WebRTC answer
});
```

## ğŸ“Š Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡

### Ú©Ø§Ø±Ø¨Ø± (User)
```javascript
{
  _id: ObjectId,
  username: String (unique),
  email: String (unique),
  password: String (hashed),
  displayName: String,
  avatar: String,
  role: ['user', 'moderator', 'admin'],
  status: ['active', 'inactive', 'banned', 'pending'],
  gender: ['male', 'female', 'other'],
  birthDate: Date,
  country: String,
  language: ['fa', 'en'],
  
  preferences: {
    ageRange: { min: Number, max: Number },
    genderPreference: ['male', 'female', 'both'],
    allowLocation: Boolean
  },
  
  subscription: {
    type: ['free', 'premium', 'vip'],
    expiresAt: Date,
    autoRenew: Boolean
  },
  
  stats: {
    totalChats: Number,
    totalMinutes: Number,
    averageRating: Number,
    reportCount: Number
  },
  
  privacy: {
    showOnline: Boolean,
    allowMessages: Boolean,
    profileVisibility: ['public', 'friends', 'private']
  },
  
  friends: [{ user: ObjectId, addedAt: Date }],
  friendRequests: [{ from: ObjectId, sentAt: Date }],
  blockedUsers: [ObjectId],
  
  createdAt: Date,
  updatedAt: Date,
  lastActive: Date
}
```

## ğŸ›¡ Ø§Ù…Ù†ÛŒØª

### JWT Token
```javascript
{
  id: user_id,
  role: user_role,
  subscription: subscription_type,
  iat: issued_at,
  exp: expires_at
}
```

### Ù…Ø­Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ Ù†Ø±Ø®
- 100 Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± 15 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± IP
- Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø³Ø§Ø³

### Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
- ØªÙ…Ø§Ù… ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø§ express-validator Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ sanitize Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙØ§ÛŒÙ„: 5MB

## ğŸ§ª ØªØ³Øª

```bash
# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
npm test

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø­Ø§Ù„Øª watch
npm run test:watch
```

## ğŸ“ Logging

Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¯Ø± Ù¾ÙˆØ´Ù‡ `logs/` Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯:
- `combined.log`: ØªÙ…Ø§Ù… Ù„Ø§Ú¯â€ŒÙ‡Ø§
- `error.log`: ÙÙ‚Ø· Ø®Ø·Ø§Ù‡Ø§
- `exceptions.log`: Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§

## ğŸ”§ Scripts Ù…ÙÛŒØ¯

```bash
# Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡
npm run dev

# Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª ØªÙˆÙ„ÛŒØ¯
npm start

# Ø¨Ø±Ø±Ø³ÛŒ Ú©ÛŒÙÛŒØª Ú©Ø¯
npm run lint

# Ø§ØµÙ„Ø§Ø­ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø¯
npm run lint:fix

# seed Ú©Ø±Ø¯Ù† Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
npm run seed

# migration Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
npm run migrate
```

## ğŸŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·

| Ù…ØªØºÛŒØ± | ØªÙˆØ¶ÛŒØ­Ø§Øª | Ù¾ÛŒØ´â€ŒÙØ±Ø¶ |
|-------|---------|---------|
| `NODE_ENV` | Ù…Ø­ÛŒØ· Ø§Ø¬Ø±Ø§ | development |
| `PORT` | Ù¾ÙˆØ±Øª Ø³Ø±ÙˆØ± | 8000 |
| `MONGODB_URI` | Ø¢Ø¯Ø±Ø³ MongoDB | mongodb://localhost:27017/video_chat_db |
| `JWT_SECRET` | Ú©Ù„ÛŒØ¯ Ù…Ø®ÙÛŒ JWT | - |
| `JWT_EXPIRE` | Ù…Ø¯Øª Ø§Ù†Ù‚Ø¶Ø§ÛŒ JWT | 7d |
| `CLIENT_URL` | Ø¢Ø¯Ø±Ø³ Ú©Ù„Ø§ÛŒÙ†Øª | http://localhost:3000 |

## ğŸ¤ Ù…Ø´Ø§Ø±Ú©Øª

1. Fork Ú©Ù†ÛŒØ¯
2. Ø¨Ø±Ù†Ú† Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ (`git checkout -b feature/amazing-feature`)
3. ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ commit Ú©Ù†ÛŒØ¯ (`git commit -m 'Add amazing feature'`)
4. Push Ú©Ù†ÛŒØ¯ (`git push origin feature/amazing-feature`)
5. Pull Request Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯

## ğŸ“„ Ù…Ø¬ÙˆØ²

Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ ØªØ­Øª Ù…Ø¬ÙˆØ² MIT Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª.

## ğŸ†˜ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„:
1. Ø§Ø¨ØªØ¯Ø§ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
2. Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯
3. Issue Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯

## ğŸ“ ØªÙ…Ø§Ø³

Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¨Ø§ Ù…Ø§ Ø¯Ø± ØªÙ…Ø§Ø³ Ø¨Ø§Ø´ÛŒØ¯.
